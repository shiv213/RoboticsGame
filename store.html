<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body onload="init()" id="script">
  <canvas id='c' style='position: absolute; left: 0px; top: 0px; z-index: 2;'></canvas>
  <script>
    var coinScore = localStorage.getItem('coins') || 0;
    var forcePowerups = localStorage.getItem('forcepowerup') || 0;
    var levitatePowerups = localStorage.getItem('levitatepowerup') || 0;
    var boostPowerups = localStorage.getItem('boostpowerup') || 0;

    var backgroundImage = new Image();
    var ctx;
    var buttons = [];

    var priceForce = 25;
    var priceLevitate = 50;
    var priceBoost = 30;

    function draw() {
      var canvasWidth = window.innerWidth;
      var canvasHeight = window.innerHeight;
      ctx.drawImage(backgroundImage, 0, 0, canvasWidth, canvasHeight);
      ctx.font = "20px Georgia";
      ctx.fillText("Score " + coinScore, canvasWidth * 0.3, canvasHeight * 0.3);
      ctx.fillText("" + forcePowerups, canvasWidth * 0.5, canvasHeight * 0.63);
      ctx.fillText("" + levitatePowerups, canvasWidth * 0.5, canvasHeight * 0.71);
      ctx.fillText("" + boostPowerups, canvasWidth * 0.5, canvasHeight * 0.79);
    }

    function loadBackgroundImage() {
      var canvas = document.getElementById("c");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      ctx = canvas.getContext("2d");
      console.log("loading store background");
      backgroundImage.src = "images/store.png";
      backgroundImage.onload = function() {
        draw();
      }
    }

    function buyForce(){
      console.log("Buy forcew!!!");
      if(coinScore>=priceForce) {
        forcePowerups++;
        coinScore-=priceForce;
        localStorage.setItem('coins',coinScore);
        localStorage.setItem('forcepowerup',forcePowerups);
        draw();
      }
    }

    function buyLevitate(){
      console.log("Buy levitate!!!");
      if(coinScore>=priceLevitate) {
        levitatePowerups++;
        coinScore-=priceLevitate;
        localStorage.setItem('coins',coinScore);
        localStorage.setItem('levitatepowerup',levitatePowerups);
        draw();
      }
    }

    function buyBoost(){
      console.log("Buy levitate!!!");
      if(coinScore>=priceBoost) {
        boostPowerups++;
        coinScore-=priceBoost;
        localStorage.setItem('coins',coinScore);
        localStorage.setItem('boostpowerup',boostPowerups);
        draw();
      }
    }

    function backToMainMenu(){
      window.location = "game.html";
    }

    function addButton(x1,y1,x2,y2,callback){
      buttons.push({x1:x1,y1:y1,x2:x2,y2:y2,callback:callback});
    }
    
    function setButtons() {
      var canvasWidth = window.innerWidth;
      var canvasHeight = window.innerHeight;
      addButton(382 / 1920 * canvasWidth, 642 / 1080 * canvasHeight, 690 / 1920 * canvasWidth, 706 / 1080 * canvasHeight, buyForce);
      addButton(382 / 1920 * canvasWidth, 724 / 1080 * canvasHeight, 690 / 1920 * canvasWidth, 782 / 1080 * canvasHeight, buyLevitate);
      addButton(382 / 1920 * canvasWidth, 808 / 1080 * canvasHeight, 690 / 1920 * canvasWidth, 860 / 1080 * canvasHeight, buyBoost);
      addButton(382 / 1920 * canvasWidth, 951 / 1080 * canvasHeight, 690 / 1920 * canvasWidth, 1005 / 1080 * canvasHeight, backToMainMenu);
    }

    function checkButtons(evt){
			var x = evt.changedTouches[0].pageX;
			var y = evt.changedTouches[0].pageY;
      for(var i=0;i<buttons.length;i++){
        var b = buttons[i];
        if(x>b.x1 && x<b.x2 && y>b.y1 && y<b.y2){
          b.callback();
        }
      }
    }

    function init() {
      loadBackgroundImage();
      setButtons();
      window.addEventListener('touchstart', checkButtons);
    }
  </script>
</body>

</html>
